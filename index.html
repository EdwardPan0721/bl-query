<script>
  window.search = async function () {
    const blInput = document.getElementById("blNo").value.trim();
    const containerInput = document.getElementById("containerNo").value.trim();

    if (!blInput || !containerInput) {
      alert("請輸入提單號碼和貨櫃號碼！");
      return;
    }

    try {
      const response = await fetch("https://script.google.com/macros/s/AKfycbzajr-3e-vSTnoOPnkLUw_-7pS-UEQXt6nSNsRTM3OSaMYwBbtXCCqLOB4jy_VDlMax/exec");
      const data = await response.json();

      let found = null;

      for (let i = 0; i < data.length; i++) {
        const [bl, sum, due, status, containerStr, eday, eextraday] = data[i];
        if (bl.trim() === blInput) {
          const containers = containerStr.split('/').map(c => c.trim());
          if (containers.includes(containerInput)) {
            found = { bl, status, sum, due, eday, eextraday };
            break;
          }
        }
      }

      if (found) {
        const eday = Number(String(found.eday).trim()) || 0;
        const eextraday = Number(String(found.eextraday).trim()) || 0;

        document.getElementById("bl").textContent = found.bl;
        document.getElementById("status").textContent = found.status;
        document.getElementById("sumFee").textContent = `$${Number(found.sum).toLocaleString()}`;
        document.getElementById("dueDate").textContent = formatDate(found.due);
        document.getElementById("emptyDays").textContent = eday + eextraday;
        document.getElementById("result").style.display = "block";
      } else {
        alert("查無符合資料，請確認輸入正確。");
        document.getElementById("result").style.display = "none";
      }

    } catch (err) {
      alert("查詢失敗，請稍後再試。");
      console.error(err);
    }
  }

  function formatDate(date) {
    const d = new Date(date);
    const year = d.getFullYear();
    const month = ("0" + (d.getMonth() + 1)).slice(-2);
    const day = ("0" + d.getDate()).slice(-2);
    return `${year}-${month}-${day}`;
  }
</script>
